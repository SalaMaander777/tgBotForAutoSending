{% extends "base.html" %}
{% block title %}–†–∞—Å—Å—ã–ª–∫–∞{% endblock %}
{% block content %}
<h1 class="page-title">–†–∞—Å—Å—ã–ª–∫–∞</h1>

{% if success %}
<div class="alert alert-success">{{ success }}</div>
{% endif %}
{% if error %}
<div class="alert alert-error">{{ error }}</div>
{% endif %}

<div class="form-card">
    <h2>–ù–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞</h2>
    <form method="post" enctype="multipart/form-data">
        <div class="form-group">
            <label for="text">–¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è</label>
            <textarea id="text" name="text" rows="6"
                      placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Ä–∞—Å—Å—ã–ª–∫–∏... (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –µ—Å–ª–∏ –µ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ)"></textarea>
            <small class="form-hint">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è HTML-—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</small>
        </div>
        <div class="form-group">
            <label for="image">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
            <input type="file" id="image" name="image" accept="image/*">
            <small class="form-hint">–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ. –ü—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Ñ–æ—Ç–æ —Å —Ç–µ–∫—Å—Ç–æ–º –∫–∞–∫ –ø–æ–¥–ø–∏—Å—å—é</small>
        </div>
        <button type="submit" class="btn btn-primary">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É</button>
    </form>
</div>

{% if broadcasts %}
<div class="section">
    <h2>–ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—Å—ã–ª–æ–∫</h2>
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>–¢–∏–ø</th>
                    <th>–î–∞—Ç–∞</th>
                    <th>–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ</th>
                    <th>–û—à–∏–±–æ–∫</th>
                    <th>–¢–µ–∫—Å—Ç</th>
                </tr>
            </thead>
            <tbody>
                {% for bc in broadcasts %}
                <tr>
                    <td>{{ bc.id }}</td>
                    <td>
                        {% if bc.type == 'text' %}üìù –¢–µ–∫—Å—Ç
                        {% elif bc.type == 'image' %}üñº –§–æ—Ç–æ
                        {% else %}üñºüìù –§–æ—Ç–æ+—Ç–µ–∫—Å—Ç
                        {% endif %}
                    </td>
                    <td>{{ bc.sent_at.strftime('%d.%m.%Y %H:%M') }}</td>
                    <td><span class="badge badge-success">{{ bc.total_sent }}</span></td>
                    <td>{% if bc.failed > 0 %}<span class="badge badge-error">{{ bc.failed }}</span>{% else %}0{% endif %}</td>
                    <td class="text-truncate">{{ (bc.text or '')[:80] }}{% if bc.text and bc.text|length > 80 %}...{% endif %}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}
{% endblock %}
